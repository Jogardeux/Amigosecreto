<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Amigo Secreto</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 500px;
    }
    h1 {
      text-align: center;
    }
    textarea {
      width: 100%;
      height: 150px;
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #1e40af;
    }
    .links {
      margin-top: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .links a {
      margin: 5px;
      text-decoration: none;
      background: #10b981;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
    }
    .links a:hover {
      background: #047857;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>游꾸 Amigo Secreto</h1>
    <textarea id="nombres" placeholder="Escribe un nombre por l칤nea..."></textarea>
    <button onclick="repartir()">Repartir</button>
    <div id="resultados" class="links"></div>
  </div>

  <script>
    let paresGlobal = [];

    function repartir() {
      let textarea = document.getElementById("nombres");
      let lista = textarea.value.split("\n").map(n => n.trim()).filter(n => n);

      if (lista.length < 2) {
        alert("Debes ingresar al menos 2 nombres.");
        return;
      }

      let asignados;
      let intentos = 0;
      let asignacionValida = false;

      while (!asignacionValida && intentos < 5000) {
        intentos++;
        asignados = [...lista].sort(() => Math.random() - 0.5);
        asignacionValida = true;

        paresGlobal = lista.map((nombre, i) => {
          return { de: nombre, para: asignados[i] };
        });

        if (paresGlobal.some(p => p.de === p.para)) {
          asignacionValida = false;
          continue;
        }

        for (let p of paresGlobal) {
          let inverso = paresGlobal.find(x => x.de === p.para && x.para === p.de);
          if (inverso) {
            asignacionValida = false;
            break;
          }
        }
      }

      let div = document.getElementById("resultados");
      div.innerHTML = "";
      if (asignacionValida) {
        paresGlobal.forEach((r) => {
          let secretoUrl = generarUrlSecreto(r);
          let link = document.createElement("a");
          link.href = `https://api.whatsapp.com/send?text=${encodeURIComponent("游꾸 Hola " + r.de + ", tu amigo secreto es: " + secretoUrl)}`;
          link.target = "_blank";
          link.textContent = `Enviar a ${r.de} por WhatsApp`;
          div.appendChild(link);
        });
      } else {
        div.innerHTML = "<p>No se pudo generar una asignaci칩n v치lida. Intenta de nuevo.</p>";
      }
    }

    function generarUrlSecreto(par) {
      let secreto = btoa(JSON.stringify(par));
      let urlBase = window.location.origin + window.location.pathname;
      return `${urlBase}?secreto=${secreto}`;
    }

    window.onload = function() {
      let params = new URLSearchParams(window.location.search);
      if (params.has("secreto")) {
        let data = JSON.parse(atob(params.get("secreto")));
        document.body.innerHTML = `
          <div style="display:flex;justify-content:center;align-items:center;height:100vh;font-family:Arial,sans-serif;background:#f3f4f6;">
            <div style="background:white;padding:20px;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,0.2);text-align:center;">
              <h2>游꾸 Hola ${data.de}</h2>
              <p>Tu amigo secreto es:</p>
              <h1>${data.para}</h1>
            </div>
          </div>`;
      }
    }
  </script>
</body>
</html>
